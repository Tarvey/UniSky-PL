<sheet:SheetControl
    xmlns:sheet="using:UniSky.Controls.Sheet"
    x:Class="UniSky.Controls.Compose.ComposeSheet"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:UniSky.Controls.Compose"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:converters="using:UniSky.Converters"
    mc:Ignorable="d" d:DesignHeight="300" d:DesignWidth="320"
    Style="{StaticResource DefaultSheetControlStyle}"
    DataContext="{x:Bind ViewModel, Mode=OneWay}"
    PrimaryButtonCommand="{x:Bind ViewModel.PostCommand}"
    IsPrimaryButtonEnabled="{x:Bind ViewModel.CanPost, Mode=OneWay}"
    SecondaryButtonCommand="{x:Bind ViewModel.HideCommand}">
    <sheet:SheetControl.TitleContent>
        <TextBlock Text="NEW POST"/>
    </sheet:SheetControl.TitleContent>
    <sheet:SheetControl.PrimaryButtonContent>
        <TextBlock Text="Post" Margin="8,0"/>
    </sheet:SheetControl.PrimaryButtonContent>
    <sheet:SheetControl.SecondaryButtonContent>
        <TextBlock Text="Cancel"/>
    </sheet:SheetControl.SecondaryButtonContent>

    <Grid x:Name="ContentGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid x:Name="ErrorContainer"
              x:Load="{x:Bind ViewModel.IsErrored, Mode=OneWay}"
              Padding="12,0">
            <Grid.Background>
                <SolidColorBrush Opacity="0.2" Color="{ThemeResource SystemErrorTextColor}"/>
            </Grid.Background>
            
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Viewbox Width="16"
                     Height="16"
                     Margin="0,10,0,0"
                     VerticalAlignment="Top">
                <TextBlock FontFamily="{ThemeResource SymbolThemeFontFamily}">&#xE783;</TextBlock>
            </Viewbox>

            <TextBlock Text="{Binding Error.Message, FallbackValue='Something went wrong!'}"
                       TextWrapping="Wrap"
                       Margin="8"
                       Grid.Column="1"
                       MaxLines="2"/>
        </Grid>

        <ProgressBar Grid.Row="1"
                     VerticalAlignment="Top"
                     Background="Transparent"
                     IsIndeterminate="{x:Bind ViewModel.IsLoading, Mode=OneWay}" />
        
        <UserControl Margin="12"
                     Grid.Row="1"
                     HorizontalAlignment="Stretch"
                     HorizontalContentAlignment="Stretch"
                     VerticalAlignment="Stretch"
                     VerticalContentAlignment="Stretch"
                     IsEnabled="{x:Bind converters:Static.Not(ViewModel.IsLoading), Mode=OneWay}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Ellipse Width="64" 
                         Height="64"
                         Margin="0,0,8,0"
                         Grid.RowSpan="2"
                         VerticalAlignment="Top">
                    <Ellipse.Fill>
                        <ImageBrush>
                            <ImageBrush.ImageSource>
                                <BitmapImage UriSource="{Binding AvatarUrl}"
                                             DecodePixelWidth="48"
                                             DecodePixelHeight="48"
                                             DecodePixelType="Logical"/>
                            </ImageBrush.ImageSource>
                        </ImageBrush>
                    </Ellipse.Fill>
                </Ellipse>
                <TextBox x:Name="PrimaryTextBox"
                         Style="{StaticResource BorderlessTextBoxStyle}"
                         Grid.Column="1"
                         Text="{x:Bind ViewModel.Text, Mode=TwoWay}" 
                         PlaceholderText="What's happening?" 
                         MaxLength="300" />
            </Grid>
        </UserControl>
    </Grid>
</sheet:SheetControl>
